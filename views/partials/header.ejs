<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BOOKSHELF - Where Books Meet Community</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/img/favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/img/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/img/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/img/favicon-16x16.png"
    />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        safelist: [
          "text-primary",
          "bg-primary",
          "text-secondary",
          "bg-secondary",
          "text-accent",
          "bg-accent",
          "text-dark",
          "bg-dark",
          "text-light",
          "bg-light",
        ],
        theme: {
          extend: {
            colors: {
              primary: "#f0c264",
              "primary-dark": "#d4a94c",
              secondary: "#2c3e50",
              accent: "#e67e22",
              dark: "#2c3e50",
              light: "#f8f9fa",
              "text-light": "#6c757d",
              background: "#f8f9fa",
            },
            fontFamily: {
              dancing: ['"Dancing Script"', "cursive"],
              sans: ["Inter", "sans-serif"],
              serif: ['"Playfair Display"', "serif"],
            },
          },
        },
      };
    </script>
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css" />
    <script>
      // Define Tailwind classes using CSS-in-JS
      tailwind.config.plugins = [
        ({ addComponents }) => {
          addComponents({
            ".btn-primary": {
              backgroundColor: "var(--tw-color-primary)",
              color: "var(--tw-color-secondary)",
              fontWeight: "600",
              padding: "0.5rem 1.5rem",
              borderRadius: "9999px",
              transition: "all 0.3s ease",
            },
            ".btn-primary:hover": {
              backgroundColor: "var(--tw-color-primary-dark)",
            },
            ".btn-secondary": {
              backgroundColor: "var(--tw-color-secondary)",
              color: "white",
              fontWeight: "600",
              padding: "0.5rem 1.5rem",
              borderRadius: "9999px",
              transition: "all 0.3s ease",
            },
            ".btn-secondary:hover": {
              backgroundColor: "var(--tw-color-secondary-dark)",
            },
            ".btn-outline": {
              border: "2px solid var(--tw-color-primary)",
              color: "var(--tw-color-primary)",
              fontWeight: "600",
              padding: "0.5rem 1.5rem",
              borderRadius: "9999px",
              transition: "all 0.3s ease",
            },
            ".btn-outline:hover": {
              backgroundColor: "var(--tw-color-primary)",
              color: "var(--tw-color-secondary)",
            },
            ".section-title": {
              fontSize: "1.875rem",
              fontFamily: '"Dancing Script", cursive',
              fontWeight: "bold",
              textAlign: "center",
              marginBottom: "2rem",
              color: "var(--tw-color-secondary)",
            },
            ".card": {
              backgroundColor: "white",
              borderRadius: "0.5rem",
              boxShadow: "0 10px 15px -3px rgba(0, 0, 0, 0.1)",
              overflow: "hidden",
              transition: "transform 0.3s ease",
              border: "1px solid rgba(240, 194, 100, 0.1)",
            },
            ".card:hover": {
              boxShadow: "0 20px 25px -5px rgba(0, 0, 0, 0.1)",
              transform: "translateY(-5px)",
              borderColor: "rgba(240, 194, 100, 0.3)",
            },
            ".nav-link": {
              color: "var(--tw-color-secondary)",
              transition: "color 0.3s ease",
            },
            ".nav-link:hover": {
              color: "var(--tw-color-primary)",
            },
            ".tab": {
              padding: "0.5rem 1rem",
              color: "var(--tw-color-text-light)",
              borderBottom: "2px solid transparent",
              transition: "all 0.3s ease",
            },
            ".tab:hover": {
              color: "var(--tw-color-primary)",
              borderColor: "var(--tw-color-primary)",
            },
            ".tab.active": {
              color: "var(--tw-color-primary)",
              borderColor: "var(--tw-color-primary)",
            },
          });
        },
      ];
    </script>
    <style type="text/css">
      /* Custom styles for header scroll effect */
      #header.scrolled {
        background: linear-gradient(
          to right,
          rgba(44, 62, 80, 0.85),
          rgba(44, 62, 80, 0.8)
        );
        backdrop-filter: blur(12px);
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
        box-shadow: 0 4px 20px rgba(44, 62, 80, 0.2);
        border-bottom-color: rgba(240, 194, 100, 0.3);
      }
      #header.scrolled .logo-img {
        height: 2.5rem;
      }
      .logo-img {
        height: 3rem;
        transition: all 0.3s ease;
      }
      /* Enhanced search bar styling */
      .search-input {
        border-color: rgba(240, 194, 100, 0.2);
        transition: all 0.3s ease;
      }
      .search-input:focus {
        border-color: #f0c264;
        box-shadow: 0 0 0 3px rgba(240, 194, 100, 0.1);
      }
      /* Cart badge styling */
      .cart-badge {
        background-color: #f0c264;
        color: #2c3e50;
        font-weight: 600;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      /* Navigation link styling */
      .nav-link {
        color: white;
        transition: all 0.3s ease;
        position: relative;
      }
      .nav-link:hover {
        color: #f0c264;
      }
      .nav-link::after {
        content: "";
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 0;
        height: 2px;
        background-color: #f0c264;
        transition: width 0.3s ease;
      }
      .nav-link:hover::after {
        width: 100%;
      }
    </style>
    <!-- Cart JS -->
    <script src="/js/cart.js" defer></script>
  </head>

  <body
    class="flex flex-col min-h-screen font-sans text-secondary bg-background"
  >
    <!-- Header -->
    <header
      id="header"
      class="fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-[#2c3e50]/95 to-[#2c3e50]/90 backdrop-blur-md transition-all duration-300 py-4 border-b border-[#f0c264]/20 shadow-sm"
    >
      <div class="container mx-auto px-4 flex items-center justify-between">
        <a href="/" class="flex items-center group">
          <span
            class="text-2xl font-bold text-white logo font-serif tracking-wider logo-img transform transition-transform duration-300 group-hover:scale-105"
            style="line-height: 1"
            >B O O K S H E L F</span
          >
        </a>

        <!-- Search Bar -->
        <div class="hidden md:flex items-center flex-1 max-w-xl mx-8">
          <form action="/browse" method="GET" class="relative w-full">
            <input
              type="text"
              name="search"
              placeholder="Search by title, author, genres..."
              class="w-full py-2.5 px-5 pr-12 rounded-full border-2 border-[#f0c264]/20 bg-white/10 backdrop-blur-sm text-white placeholder-white/70 search-input focus:outline-none focus:ring-2 focus:ring-[#f0c264] focus:border-[#f0c264] transition-all duration-300 text-sm shadow-sm hover:shadow-md"
            />
            <button
              type="submit"
              class="absolute right-4 top-1/2 transform -translate-y-1/2 text-white/70 hover:text-[#f0c264] transition-colors duration-300"
            >
              <i class="fas fa-search"></i>
            </button>
          </form>
        </div>

        <div class="flex items-center space-x-6 md:space-x-8">
          <% if (user) { %> <% if (user.role==='buyer' ) { %>
          <a href="/buyer/cart" class="nav-link relative group">
            <i
              class="fa-solid fa-basket-shopping text-xl text-white transform transition-transform duration-300 group-hover:scale-110 group-hover:text-[#f0c264]"
            ></i>
            <span
              id="cart-count"
              class="absolute -top-2 -right-2 cart-badge text-xs rounded-full h-5 w-5 flex items-center justify-center transform transition-transform duration-300 group-hover:scale-110"
              >0</span
            >
          </a>
          <a href="/buyer/library" class="nav-link hidden sm:block group">
            <i
              class="fa-solid fa-book-bookmark text-xl text-white transform transition-transform duration-300 group-hover:scale-110 group-hover:text-[#f0c264]"
            ></i>
          </a>
          <% } %> <% } else { %> <% } %>

          <!-- User Sidebar Toggle Button -->
          <button
            id="user-icon-button"
            class="nav-link focus:outline-none relative transition-all duration-300 group"
            aria-label="Open user menu"
            aria-controls="user-sidebar"
            aria-expanded="false"
          >
            <span
              class="icon-bar transition-all duration-300 ease-in-out block transform group-hover:scale-110 text-white group-hover:text-[#f0c264]"
              ><i class="fas fa-bars text-xl"></i
            ></span>
            <span
              class="icon-close transition-all duration-300 ease-in-out block absolute inset-0 opacity-0 pointer-events-none transform group-hover:scale-110 text-white group-hover:text-[#f0c264]"
              ><i class="fas fa-times text-xl"></i
            ></span>
          </button>

          <!-- Mobile Menu Toggle -->
          <button id="mobile-menu-button" class="md:hidden nav-link group">
            <i
              class="fas fa-bars text-xl text-white transform transition-transform duration-300 group-hover:scale-110 group-hover:text-[#f0c264]"
            ></i>
          </button>
        </div>
      </div>
      <!-- Mobile Search Bar & Navigation -->
      <div
        id="mobile-menu"
        class="md:hidden hidden bg-[#2c3e50]/95 backdrop-blur-md px-4 pt-2 pb-4 space-y-3 shadow-lg border-t border-[#f0c264]/20"
      >
        <form action="/browse" method="GET" class="relative w-full">
          <input
            type="text"
            name="search"
            placeholder="Search books..."
            class="w-full py-2.5 px-4 pr-10 rounded-full border-2 border-[#f0c264]/20 bg-white/10 backdrop-blur-sm text-white placeholder-white/70 search-input focus:outline-none focus:ring-2 focus:ring-[#f0c264] focus:border-[#f0c264] transition-all duration-300 text-sm shadow-sm"
          />
          <button
            type="submit"
            class="absolute right-4 top-1/2 transform -translate-y-1/2 text-white/70 hover:text-[#f0c264] transition-colors duration-300"
          >
            <i class="fas fa-search"></i>
          </button>
        </form>
        <nav class="flex flex-col space-y-2">
          <a
            href="/"
            class="block px-4 py-2.5 rounded-lg text-base font-medium text-white hover:text-[#f0c264] hover:bg-white/10 transition-colors duration-300"
            >Home</a
          >
          <a
            href="/browse"
            class="block px-4 py-2.5 rounded-lg text-base font-medium text-white hover:text-[#f0c264] hover:bg-white/10 transition-colors duration-300"
            >Browse Books</a
          >
          <a
            href="/pricing"
            class="block px-4 py-2.5 rounded-lg text-base font-medium text-white hover:text-[#f0c264] hover:bg-white/10 transition-colors duration-300"
            >Pricing</a
          >
          <a
            href="/buyer/video-feed"
            class="block px-4 py-2.5 rounded-lg text-base font-medium text-white hover:text-[#f0c264] hover:bg-white/10 transition-colors duration-300"
            >Video Feed</a
          >
          <a
            href="/about"
            class="block px-4 py-2.5 rounded-lg text-base font-medium text-white hover:text-[#f0c264] hover:bg-white/10 transition-colors duration-300"
            >About Us</a
          >
          <a
            href="/contact"
            class="block px-4 py-2.5 rounded-lg text-base font-medium text-white hover:text-[#f0c264] hover:bg-white/10 transition-colors duration-300"
            >Contact</a
          >
          <% if (user && user.role ==='buyer') { %>
          <a
            href="/buyer/cart"
            class="block px-4 py-2.5 rounded-lg text-base font-medium text-white hover:text-[#f0c264] hover:bg-white/10 transition-colors duration-300"
            >My Cart</a
          >
          <a
            href="/buyer/library"
            class="block px-4 py-2.5 rounded-lg text-base font-medium text-white hover:text-[#f0c264] hover:bg-white/10 transition-colors duration-300"
            >My Library</a
          >
          <% } %> <% if (!user) { %>
          <a
            href="/auth/register"
            class="block px-4 py-2.5 rounded-lg text-base font-medium text-white hover:text-[#f0c264] hover:bg-white/10 transition-colors duration-300"
            >Register</a
          >
          <% } %>
        </nav>
      </div>
    </header>
    <script>
      const header = document.getElementById("header");
      const mobileMenuButton = document.getElementById("mobile-menu-button");
      const mobileMenu = document.getElementById("mobile-menu");

      window.addEventListener("scroll", () => {
        if (window.scrollY > 50) {
          header.classList.add("scrolled");
        } else {
          header.classList.remove("scrolled");
        }
      });

      if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener("click", () => {
          mobileMenu.classList.toggle("hidden");
        });
      }

      // Sidebar icon animation logic
      const userIconButton = document.getElementById("user-icon-button");
      if (userIconButton) {
        function updateSidebarIcon(isOpen) {
          const bar = userIconButton.querySelector(".icon-bar");
          const close = userIconButton.querySelector(".icon-close");
          if (isOpen) {
            bar.classList.add("opacity-0", "pointer-events-none");
            bar.classList.remove("opacity-100");
            close.classList.remove("opacity-0", "pointer-events-none");
            close.classList.add("opacity-100");
          } else {
            bar.classList.remove("opacity-0", "pointer-events-none");
            bar.classList.add("opacity-100");
            close.classList.add("opacity-0", "pointer-events-none");
            close.classList.remove("opacity-100");
          }
        }
        // Listen for sidebar open/close events
        document.addEventListener("sidebar:open", () =>
          updateSidebarIcon(true)
        );
        document.addEventListener("sidebar:close", () =>
          updateSidebarIcon(false)
        );
        // Initial state
        updateSidebarIcon(false);
      }
    </script>

    <!-- Navigation Menu -->
    <nav class="hidden md:flex items-center space-x-6">
      <a href="/" class="nav-link group">
        <span class="group-hover:text-[#f0c264] transition-all duration-300"
          >Home</span
        >
      </a>
      <a href="/browse" class="nav-link group">
        <span class="group-hover:text-[#f0c264] transition-all duration-300"
          >Browse</span
        >
      </a>
      <a href="/blog" class="nav-link group">
        <span class="group-hover:text-[#f0c264] transition-all duration-300"
          >Blogs</span
        >
      </a>
      <a href="/recommendations" class="nav-link group">
        <span class="group-hover:text-[#f0c264] transition-all duration-300"
          >Recommendations</span
        >
      </a>
      <a href="/groups" class="nav-link group">
        <span class="group-hover:text-[#f0c264] transition-all duration-300"
          >Communities</span
        >
      </a>
      <a href="/ebooks" class="nav-link group">
        <span class="group-hover:text-[#f0c264] transition-all duration-300"
          >E-book Market</span
        >
      </a>
      <a href="/universities" class="nav-link group">
        <span class="group-hover:text-[#f0c264] transition-all duration-300"
          >University</span
        >
      </a>
    </nav>

    <!-- Flash Messages -->
    <% if(typeof success_msg !=='undefined' && success_msg.length> 0) { %>
    <div
      class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 relative container mx-auto mt-4 mb-0"
      role="alert"
    >
      <p class="font-bold">Success</p>
      <p><%= success_msg %></p>
      <button
        type="button"
        class="absolute top-0 bottom-0 right-0 px-4 py-3"
        onclick="this.parentElement.style.display='none';"
      >
        <i class="fas fa-times"></i>
      </button>
    </div>
    <% } %> <% if(typeof error_msg !=='undefined' && error_msg.length> 0) { %>
    <div
      class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 relative container mx-auto mt-4 mb-0"
      role="alert"
    >
      <p class="font-bold">Error</p>
      <p><%= error_msg %></p>
      <button
        type="button"
        class="absolute top-0 bottom-0 right-0 px-4 py-3"
        onclick="this.parentElement.style.display='none';"
      >
        <i class="fas fa-times"></i>
      </button>
    </div>
    <% } %>
    <!-- Main Content Placeholder - to ensure content starts below header -->
    <main class="flex-grow">
      <!-- The rest of your page content will go here -->
    </main>
    <div class="extra"></div>
    <!-- This was in original, keeping it for now -->

    <%- include('user-sidebar') %>
    <script src="/js/sidebar.js" defer></script>
    <!-- Update mobile menu to include new features -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Update mobile menu to include new features
        const mobileMenu = document.getElementById("mobile-menu");
        if (mobileMenu) {
          const mobileNav = mobileMenu.querySelector("nav");

          // Check if we need to add the new features
          if (!mobileNav.querySelector('a[href="/blog"]')) {
            // Add new feature links after "Video Feed" link
            const videoFeedLink = Array.from(
              mobileNav.querySelectorAll("a")
            ).find((a) => a.href.includes("/buyer/video-feed"));

            if (videoFeedLink) {
              const blogLink = document.createElement("a");
              blogLink.href = "/blog";
              blogLink.className =
                "block px-4 py-2.5 rounded-lg text-base font-medium text-white hover:text-[#f0c264] hover:bg-white/10 transition-colors duration-300";
              blogLink.textContent = "Blogs";

              const recommendationsLink = document.createElement("a");
              recommendationsLink.href = "/recommendations";
              recommendationsLink.className =
                "block px-4 py-2.5 rounded-lg text-base font-medium text-white hover:text-[#f0c264] hover:bg-white/10 transition-colors duration-300";
              recommendationsLink.textContent = "Recommendations";

              const groupsLink = document.createElement("a");
              groupsLink.href = "/groups";
              groupsLink.className =
                "block px-4 py-2.5 rounded-lg text-base font-medium text-white hover:text-[#f0c264] hover:bg-white/10 transition-colors duration-300";
              groupsLink.textContent = "Genre Communities";

              const ebooksLink = document.createElement("a");
              ebooksLink.href = "/ebooks";
              ebooksLink.className =
                "block px-4 py-2.5 rounded-lg text-base font-medium text-white hover:text-[#f0c264] hover:bg-white/10 transition-colors duration-300";
              ebooksLink.textContent = "E-Book Market";

              const universitiesLink = document.createElement("a");
              universitiesLink.href = "/universities";
              universitiesLink.className =
                "block px-4 py-2.5 rounded-lg text-base font-medium text-white hover:text-[#f0c264] hover:bg-white/10 transition-colors duration-300";
              universitiesLink.textContent = "University Groups";

              // Insert new links after videoFeedLink
              videoFeedLink.parentNode.insertBefore(
                blogLink,
                videoFeedLink.nextSibling
              );
              videoFeedLink.parentNode.insertBefore(
                recommendationsLink,
                blogLink.nextSibling
              );
              videoFeedLink.parentNode.insertBefore(
                groupsLink,
                recommendationsLink.nextSibling
              );
              videoFeedLink.parentNode.insertBefore(
                ebooksLink,
                groupsLink.nextSibling
              );
              videoFeedLink.parentNode.insertBefore(
                universitiesLink,
                ebooksLink.nextSibling
              );
            }
          }
        }
      });
    </script>
  </body>
</html>
