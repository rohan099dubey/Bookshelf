<%- include('../partials/header') %>

<div class="container mx-auto px-4 py-8 mt-16">
  <div class="max-w-4xl mx-auto">
    <div class="flex items-center mb-6">
      <a
        href="/ebooks"
        class="text-secondary hover:text-primary transition mr-3"
      >
        <i class="fas fa-arrow-left"></i>
      </a>
      <h1 class="text-3xl font-bold text-secondary">Upload E-Book</h1>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6">
      <form action="/ebooks" method="POST" enctype="multipart/form-data">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Left column -->
          <div>
            <div class="mb-6">
              <label for="title" class="block text-secondary font-medium mb-2"
                >Book Title</label
              >
              <input
                type="text"
                id="title"
                name="title"
                required
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                placeholder="Enter the book title"
              />
            </div>

            <div class="mb-6">
              <label for="author" class="block text-secondary font-medium mb-2"
                >Author</label
              >
              <input
                type="text"
                id="author"
                name="author"
                required
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                placeholder="Enter the author's name"
              />
            </div>

            <div class="mb-6">
              <label
                for="category"
                class="block text-secondary font-medium mb-2"
                >Category</label
              >
              <select
                id="category"
                name="category"
                required
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
              >
                <option value="">Select a category</option>
                <option value="Fiction">Fiction</option>
                <option value="Non-Fiction">Non-Fiction</option>
                <option value="Mystery & Thriller">Mystery & Thriller</option>
                <option value="Science Fiction">Science Fiction</option>
                <option value="Fantasy">Fantasy</option>
                <option value="Romance">Romance</option>
                <option value="Horror">Horror</option>
                <option value="Biography">Biography</option>
                <option value="Self-Help">Self-Help</option>
                <option value="Business">Business</option>
                <option value="Cooking">Cooking</option>
                <option value="History">History</option>
                <option value="Science & Technology">
                  Science & Technology
                </option>
                <option value="Travel">Travel</option>
                <option value="Children's">Children's</option>
                <option value="Comics & Graphic Novels">
                  Comics & Graphic Novels
                </option>
                <option value="Academic">Academic</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div class="mb-6">
              <label for="price" class="block text-secondary font-medium mb-2"
                >Price (â‚¹)</label
              >
              <input
                type="number"
                id="price"
                name="price"
                required
                min="0"
                step="1"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                placeholder="Enter price (0 for free)"
              />
              <p class="text-sm text-text-light mt-1">
                Set the price to 0 if you want to share this e-book for free.
              </p>
            </div>
          </div>

          <!-- Right column -->
          <div>
            <div class="mb-6">
              <label
                for="description"
                class="block text-secondary font-medium mb-2"
                >Description</label
              >
              <textarea
                id="description"
                name="description"
                required
                rows="4"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                placeholder="Write a description of the book..."
              ></textarea>
            </div>

            <div class="mb-6">
              <label
                for="fileType"
                class="block text-secondary font-medium mb-2"
                >File Type</label
              >
              <select
                id="fileType"
                name="fileType"
                required
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
              >
                <option value="">Select file format</option>
                <option value="pdf">PDF</option>
                <option value="epub">EPUB</option>
                <option value="mobi">MOBI</option>
              </select>
            </div>

            <div class="mb-6">
              <label
                for="coverImage"
                class="block text-secondary font-medium mb-2"
                >Cover Image</label
              >
              <div
                class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:bg-gray-50 transition"
                id="cover-image-drop"
              >
                <input
                  type="file"
                  id="coverImage"
                  name="coverImage"
                  accept="image/*"
                  class="hidden"
                  onchange="previewCoverImage(event)"
                />
                <div id="cover-image-preview" class="hidden mb-3 mx-auto">
                  <img
                    id="preview-img"
                    class="h-40 max-w-full object-contain mx-auto"
                  />
                </div>
                <div id="cover-image-placeholder">
                  <i class="fas fa-image text-gray-400 text-3xl mb-2"></i>
                  <p class="text-sm text-text-light">
                    Click or drag to upload cover image
                  </p>
                  <p class="text-xs text-text-light mt-1">
                    (Optional - We'll use a default if not provided)
                  </p>
                </div>
              </div>
            </div>

            <div class="mb-6">
              <label for="ebook" class="block text-secondary font-medium mb-2"
                >E-Book File</label
              >
              <div
                class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:bg-gray-50 transition"
                id="ebook-drop"
              >
                <input
                  type="file"
                  id="ebook"
                  name="ebook"
                  accept=".pdf,.epub,.mobi"
                  required
                  class="hidden"
                  onchange="previewEbook(event)"
                />
                <div id="ebook-preview" class="hidden mb-3">
                  <i class="fas fa-file-pdf text-primary text-3xl mb-2"></i>
                  <p id="ebook-name" class="text-sm text-secondary"></p>
                </div>
                <div id="ebook-placeholder">
                  <i class="fas fa-file-upload text-gray-400 text-3xl mb-2"></i>
                  <p class="text-sm text-text-light">
                    Click or drag to upload e-book file
                  </p>
                  <p class="text-xs text-text-light mt-1">
                    Supported formats: PDF, EPUB, MOBI (max 50MB)
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="mb-6 border-t border-gray-200 pt-6">
          <div
            class="bg-blue-50 border-l-4 border-blue-500 text-blue-700 p-4"
            role="alert"
          >
            <p class="font-bold">By uploading this e-book, you confirm that:</p>
            <ul class="list-disc list-inside ml-2 mt-2">
              <li>
                You own the rights to distribute this content or have permission
                to do so
              </li>
              <li>
                The content does not violate our terms of service or any
                copyright laws
              </li>
              <li>You are responsible for the content you upload and share</li>
            </ul>
          </div>
        </div>

        <div class="flex justify-end">
          <a
            href="/ebooks"
            class="px-6 py-2 border border-gray-300 rounded-lg text-secondary mr-3 hover:bg-gray-50 transition"
          >
            Cancel
          </a>
          <button
            type="submit"
            class="px-6 py-2 bg-primary text-secondary font-semibold rounded-lg hover:bg-primary-dark transition"
          >
            Upload E-Book
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Setup drag and drop for cover image
    const coverImageDrop = document.getElementById("cover-image-drop");
    const coverImageInput = document.getElementById("coverImage");

    coverImageDrop.addEventListener("click", function () {
      coverImageInput.click();
    });

    coverImageDrop.addEventListener("dragover", function (e) {
      e.preventDefault();
      e.stopPropagation();
      coverImageDrop.classList.add("border-primary");
    });

    coverImageDrop.addEventListener("dragleave", function (e) {
      e.preventDefault();
      e.stopPropagation();
      coverImageDrop.classList.remove("border-primary");
    });

    coverImageDrop.addEventListener("drop", function (e) {
      e.preventDefault();
      e.stopPropagation();
      coverImageDrop.classList.remove("border-primary");

      if (e.dataTransfer.files.length) {
        coverImageInput.files = e.dataTransfer.files;
        previewCoverImage({ target: coverImageInput });
      }
    });

    // Setup drag and drop for ebook
    const ebookDrop = document.getElementById("ebook-drop");
    const ebookInput = document.getElementById("ebook");

    ebookDrop.addEventListener("click", function () {
      ebookInput.click();
    });

    ebookDrop.addEventListener("dragover", function (e) {
      e.preventDefault();
      e.stopPropagation();
      ebookDrop.classList.add("border-primary");
    });

    ebookDrop.addEventListener("dragleave", function (e) {
      e.preventDefault();
      e.stopPropagation();
      ebookDrop.classList.remove("border-primary");
    });

    ebookDrop.addEventListener("drop", function (e) {
      e.preventDefault();
      e.stopPropagation();
      ebookDrop.classList.remove("border-primary");

      if (e.dataTransfer.files.length) {
        ebookInput.files = e.dataTransfer.files;
        previewEbook({ target: ebookInput });
      }
    });
  });

  function previewCoverImage(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      const preview = document.getElementById("preview-img");
      const previewContainer = document.getElementById("cover-image-preview");
      const placeholder = document.getElementById("cover-image-placeholder");

      reader.onload = function (e) {
        preview.src = e.target.result;
        previewContainer.classList.remove("hidden");
        placeholder.classList.add("hidden");
      };

      reader.readAsDataURL(file);
    }
  }

  function previewEbook(event) {
    const file = event.target.files[0];
    if (file) {
      const previewContainer = document.getElementById("ebook-preview");
      const placeholder = document.getElementById("ebook-placeholder");
      const ebookName = document.getElementById("ebook-name");

      // Update file type icon based on extension
      const fileIcon = previewContainer.querySelector("i");
      const extension = file.name.split(".").pop().toLowerCase();

      if (extension === "pdf") {
        fileIcon.className = "fas fa-file-pdf text-red-500 text-3xl mb-2";
      } else if (extension === "epub") {
        fileIcon.className = "fas fa-book text-blue-500 text-3xl mb-2";
      } else if (extension === "mobi") {
        fileIcon.className = "fas fa-tablet-alt text-green-500 text-3xl mb-2";
      }

      // Update filename display
      ebookName.textContent = file.name;

      // Show preview, hide placeholder
      previewContainer.classList.remove("hidden");
      placeholder.classList.add("hidden");

      // Update fileType dropdown to match the uploaded file
      const fileTypeSelect = document.getElementById("fileType");
      if (extension === "pdf" || extension === "epub" || extension === "mobi") {
        fileTypeSelect.value = extension;
      }
    }
  }
</script>

<%- include('../partials/footer') %>
